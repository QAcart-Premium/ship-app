// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User model represents registered users
model User {
  id        Int      @id @default(autoincrement())

  // Authentication
  email     String   @unique
  password  String   // hashed with bcrypt

  // Personal Information (used as sender details)
  fullName   String
  phone      String
  country    String
  city       String
  street     String
  postalCode String

  // Payment Information (encrypted)
  cardNumber String   // encrypted full card number
  cardExpiry String   // encrypted expiry date
  cardCvv    String   // encrypted CVV

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  shipments Shipment[]

  @@index([email])
}

// Shipment model represents a shipping order
model Shipment {
  id        Int      @id @default(autoincrement())

  // Unique tracking number (format: TR + 9 random digits)
  trackingNumber String @unique

  // User relationship
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Sender information
  senderName       String
  senderStreet     String
  senderCity       String
  senderPostalCode String
  senderCountry    String
  senderPhone      String

  // Receiver information
  receiverName       String
  receiverStreet     String
  receiverCity       String
  receiverPostalCode String
  receiverCountry    String
  receiverPhone      String

  // Package information
  weight     Float  // in kg - important for testing boundary conditions!
  length     Float  // in cm
  width      Float  // in cm
  height     Float  // in cm
  contentDescription String @default("")

  // Shipment type: Domestic, International, or IntraGulf
  shipmentType String @default("Domestic")

  // Pickup method - great for testing radio button functionality
  pickupMethod String @default("home") // 'home' or 'postal_office'

  // Service type: Standard, Express, or Overnight
  // Great for testing dropdown/select validation
  serviceType String

  // Special services - great for testing checkbox functionality
  signatureRequired Boolean @default(false)
  containsLiquid    Boolean @default(false)

  // Additional options
  insurance Boolean @default(false)
  packaging Boolean @default(false)

  // Price calculation based on weight + service type
  // Excellent for testing business logic and calculations
  price Float

  // Cost breakdown
  baseCost       Float @default(0)
  insuranceCost  Float @default(0)
  signatureCost  Float @default(0)
  packagingCost  Float @default(0)
  totalCost      Float @default(0)

  // Draft status - useful for testing save functionality
  isDraft Boolean @default(false)

  // Current status of the shipment
  // Excellent for state transition testing
  status String @default("Pending")

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Estimated delivery date - calculated based on service type
  estimatedDelivery DateTime?

  // Actual delivery date - set when status becomes "Delivered"
  actualDelivery    DateTime?

  // Tracking events (timeline of shipment progress)
  trackingEvents TrackingEvent[]

  @@index([trackingNumber])
  @@index([status])
  @@index([createdAt])
  @@index([userId])
}

// TrackingEvent model represents events in the shipment timeline
model TrackingEvent {
  id          Int      @id @default(autoincrement())
  shipmentId  Int

  // Event status (e.g., "Order Placed", "Picked Up", "In Transit", etc.)
  status      String

  // Location where event occurred
  location    String

  // Description of the event
  description String

  // Timestamp when event occurred
  timestamp   DateTime @default(now())

  // Relation to shipment
  shipment    Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)

  @@index([shipmentId])
  @@index([timestamp])
}
